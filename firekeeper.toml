# Configuration for Firekeeper.
# See: https://github.com/firekeeper-ai/firekeeper
# Note for AI agents: Preserve all comments when modifying this configuration

# LLM provider configuration
[llm]
# OpenAI compatible API base URL
base_url = "https://openrouter.ai/api/v1"
# LLM model name
model = "google/gemini-3-flash-preview"

# Custom HTTP headers (optional)
[llm.headers]
HTTP-Referer = "https://github.com/firekeeper-ai/firekeeper"
X-Title = "firekeeper.ai"

# Custom request body fields (optional)
[llm.body]
parallel_tool_calls = true
reasoning.effort = "medium"

# Code review configuration
[review]
# Default maximum number of files to review per task
max_files_per_task = 5
# Global resources to include in review context.
# Supported formats:
# - `file://glob` - Include matched files' full text, e.g. `file://**/README.md`
# - `sh://command` - Include command output, e.g. `sh://git ls-files`
# - `skill://glob` - Include matched skills, e.g. `skill://~/skills/**/SKILL.md`
resources = []
# Allowed shell commands during review (read-only operations only).
# Commands are executed via sh on Unix/Linux, PowerShell on Windows.
# Add tools like `rg` (ripgrep), `sg` (ast-grep), `fd`, `jq` to enhance search capabilities.
allowed_shell_commands = ["ls", "cat", "rg", "sg", "fd", "head", "tail", "wc"]
# Maximum number of parallel workers (optional, defaults to unlimited)
# max_parallel_workers = ...

# Code review rules
[[rules]]
# Human-readable rule name, invisible to LLM
name = "Firekeeper Config Comments"
# Human-readable description, invisible to LLM (optional)
description = "Ensure firekeeper.toml has correct documentation comments"
# Detailed instructions for the LLM on how to check this rule
instruction = """
Check if firekeeper.toml has missing documentation comments.

Steps:
1. Check if all fields have documentation comments
2. Report violations if any field is missing a comment

Violation criteria - Report if:
- Any field lacks a documentation comment
"""
# Glob patterns to match files this rule applies to (optional, defaults to ["**/*"])
scope = ["firekeeper.toml"]
# Glob patterns to exclude from the matched scope (optional, defaults to [])
exclude = []
# Maximum number of files to review per task (optional, overrides global config).
# Increase for simple rules that only check changed files (e.g. scan for hardcoded credentials).
# Decrease for complex rules that scan many additional files (e.g. documentation sync).
max_files_per_task = 1
# Rule-specific resources to include in review context.
resources = ["file://firekeeper.toml"]
# Whether violations should block the pipeline (exit 1) (optional, defaults to true)
blocking = true
# Tip for downstream processors (e.g. coding agents) to fix violations (optional)
tip = "Use `firekeeper config format [--config firekeeper.toml]` to re-render the config file"

# Code review rules
[[rules]]
# Human-readable rule name, invisible to LLM
name = "No Magic Numbers"
# Human-readable description, invisible to LLM (optional)
description = "Prevent hardcoded numeric literals"
# Detailed instructions for the LLM on how to check this rule
instruction = """
Check for unexplained numeric literals in the provided diff.

Steps:
1. Identify numeric literals in the diff
2. Check if numbers have explanatory comments or clear context
3. Report violations for unexplained numbers

Violation criteria - Report if:
- Business logic constants without explanation (thresholds, multipliers, limits)
- Arbitrary timeouts or delays without context
- Numeric configuration values hardcoded in logic without comments
- Calculation constants without explanation

Exemptions - Do NOT report:
- 0, 1, -1 in common contexts (indexing, loops, exit codes, boolean-like)
- Numbers in test files
- Numbers in configuration files
- Numbers with nearby comments (within 3 lines above or inline)
- Numbers in default value functions with descriptive context
- HTTP status codes (200, 404, etc.)
- Common time values with clear context (60 for seconds, 24 for hours, 1000 for ms)
- Array/collection sizes in obvious contexts
"""
# Glob patterns to match files this rule applies to (optional, defaults to ["**/*"])
scope = ["**/*.rs"]
# Glob patterns to exclude from the matched scope (optional, defaults to [])
exclude = []
# Maximum number of files to review per task (optional, overrides global config).
# Increase for simple rules that only check changed files (e.g. scan for hardcoded credentials).
# Decrease for complex rules that scan many additional files (e.g. documentation sync).
max_files_per_task = 10
# Rule-specific resources to include in review context.
resources = []
# Whether violations should block the pipeline (exit 1) (optional, defaults to true)
blocking = true
# Tip for downstream processors (e.g. coding agents) to fix violations (optional)
tip = """
Define constants with descriptive names or add explanatory comments.
"""

# Code review rules
[[rules]]
# Human-readable rule name, invisible to LLM
name = "No Hardcoded Credentials"
# Human-readable description, invisible to LLM (optional)
description = "Prevent credential leaks"
# Detailed instructions for the LLM on how to check this rule
instruction = """
Check for hardcoded credentials in the provided diff.

Steps:
1. Scan the diff for credential-like strings
2. Determine if they are real credentials or placeholders
3. Report violations for any real credentials found

Violation criteria - Report if ANY found:
- API keys, tokens, secrets (e.g., "sk-...", "Bearer ...", actual secret values)
- Passwords or password hashes
- Private keys or certificates
- OAuth client secrets
- Database connection strings with credentials

Exemptions - Do NOT report:
- Placeholder/example values (e.g., "your-api-key", "sk-xxxxxx", "<API_KEY>")
- Environment variable names (e.g., "API_KEY", "DATABASE_URL")
- Public URLs and endpoints
- Email addresses and contact information
- Test/mock credentials in test files clearly marked as fake
- Documentation examples with obvious placeholders
"""
# Glob patterns to match files this rule applies to (optional, defaults to ["**/*"])
scope = ["**/*"]
# Glob patterns to exclude from the matched scope (optional, defaults to [])
exclude = ["*.lock", "*lock.json", "*ignore"]
# Maximum number of files to review per task (optional, overrides global config).
# Increase for simple rules that only check changed files (e.g. scan for hardcoded credentials).
# Decrease for complex rules that scan many additional files (e.g. documentation sync).
max_files_per_task = 10
# Rule-specific resources to include in review context.
resources = []
# Whether violations should block the pipeline (exit 1) (optional, defaults to true)
blocking = true
# Tip for downstream processors (e.g. coding agents) to fix violations (optional)
tip = """
Use environment variables or configuration files for credentials.
Replace real values with placeholders in examples.
"""

# Code review rules
[[rules]]
# Human-readable rule name, invisible to LLM
name = "Use Tool Args Structs"
# Human-readable description, invisible to LLM (optional)
description = "Use generated tool args structs and TOOL_NAME constants instead of string literals"
# Detailed instructions for the LLM on how to check this rule
instruction = """
Check if code uses tool args structs and TOOL_NAME constants in the provided diff.

Steps:
1. Identify tool name comparisons and tool argument parsing in the diff
2. Check if string literals are used instead of named constants
3. Report violations for incorrect usage

Violation criteria - Report if:
- Tool names compared with string literals (e.g., tc.function.name == "report" instead of tc.function.name == ReportArgs::TOOL_NAME)
- Tool arguments parsed with serde_json::from_str::<Value> and .get() instead of deserializing to args structs

Exemptions - Do NOT report:
- Code in tool definition files (src/tool/*.rs)
- Test code
- Generic tool handling code that doesn't know specific tool types
"""
# Glob patterns to match files this rule applies to (optional, defaults to ["**/*"])
scope = ["**/*.rs"]
# Glob patterns to exclude from the matched scope (optional, defaults to [])
exclude = []
# Maximum number of files to review per task (optional, overrides global config).
# Increase for simple rules that only check changed files (e.g. scan for hardcoded credentials).
# Decrease for complex rules that scan many additional files (e.g. documentation sync).
max_files_per_task = 10
# Rule-specific resources to include in review context.
resources = []
# Whether violations should block the pipeline (exit 1) (optional, defaults to true)
blocking = true
# Tip for downstream processors (e.g. coding agents) to fix violations (optional)
tip = """
Replace string literals with XxxArgs::TOOL_NAME constants.
Replace manual JSON parsing with serde_json::from_str::<XxxArgs>().
Import tiny_loop::tool::ToolArgs trait if needed.
"""
