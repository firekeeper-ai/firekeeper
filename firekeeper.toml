# Configuration for Firekeeper.
# See: https://github.com/firekeeper-ai/firekeeper
# Note for AI agents: Preserve all comments when modifying this configuration

# LLM provider configuration
[llm]
# OpenAI compatible API base URL
base_url = "https://openrouter.ai/api/v1"
# LLM model name
model = "google/gemini-3-flash-preview"

# Custom HTTP headers (optional)
[llm.headers]
X-Title = "firekeeper.ai"
HTTP-Referer = "https://github.com/firekeeper-ai/firekeeper"

# Custom request body fields (optional)
[llm.body]
parallel_tool_calls = true

# Code review configuration
[review]
# Maximum number of files to review per task
max_files_per_task = 5
# Global resources to include in review context.
# Supported formats:
# - `file://glob` - Include matched files' full text, e.g. `file://**/README.md`
# - `sh://command` - Include command output, e.g. `sh://git ls-files`
# - `skill://glob` - Include matched skills, e.g. `skill://~/skills/**/SKILL.md`
resources = []
# Maximum number of parallel workers (optional, defaults to unlimited)
# max_parallel_workers = ...

# Code review rules
[[rules]]
# Human-readable rule name, invisible to LLM
name = "Documentation Sync"
# Human-readable description, invisible to LLM (optional)
description = "Ensure user-facing documentation is updated with CLI changes"
# Detailed instructions for the LLM on how to check this rule
instruction = """
Check if user-facing changes have corresponding documentation updates.

Steps:
1. Read focused files to identify if changes are user-facing
2. Check if code comments (function docs, inline comments) are updated to match code changes
3. If user-facing, check CHANGELOG.md for updates under [Unreleased]
4. Check if README.md has outdated information that needs correction
5. Report violations if documentation is missing or outdated

Violation criteria - Report if ANY of these are true:
- Code behavior changed but comments/doc comments not updated
- Function signatures changed but doc comments still describe old behavior
- User-facing changes not documented in CHANGELOG.md under [Unreleased]
- README.md contains outdated information contradicting the changes
- Breaking changes not documented in CHANGELOG

Note: Don't require adding new content to README (e.g., new features/commands).
Only update README if existing content becomes outdated.

Exemptions - Do NOT report if changes are:
- Internal function implementations (not exposed to CLI)
- Code refactoring without behavior changes
- Internal helper functions or utilities
- Internal tool implementations (src/tool/) for agent system
- Internal config optimizations (scope patterns, performance tuning)
"""
# Glob patterns to match files this rule applies to (optional, defaults to ["**/*"])
scope = ["**/*.rs"]
# Glob patterns to exclude files from this rule (optional, defaults to [])
exclude = []
# Maximum number of files to review per task (optional, overrides global config).
# Increase for simple rules that only check changed files (e.g. scan for hardcoded credentials).
# Decrease for complex rules that scan many additional files (e.g. documentation sync).
max_files_per_task = 3
# Whether violations should block the pipeline (exit 1) (optional, defaults to true)
blocking = true
# Tip for downstream processors (e.g. coding agents) to fix violations (optional)
tip = ""
# Rule-specific resources to include in review context.
# Supported formats:
# - `file://glob` - Include matched files' full text, e.g. `file://**/README.md`
# - `sh://command` - Include command output, e.g. `sh://git ls-files`
# - `skill://glob` - Include matched skills, e.g. `skill://~/skills/**/SKILL.md`
resources = ["file://README.md", "sh://git ls-files"]

# Code review rules
[[rules]]
# Human-readable rule name, invisible to LLM
name = "No Code Duplication"
# Human-readable description, invisible to LLM (optional)
description = "Prevent duplicate code across files"
# Detailed instructions for the LLM on how to check this rule
instruction = """
Check if modified code duplicates existing code in other files.

Steps:
1. Read focused files to understand the modified logic
2. Search for similar code patterns in other files
3. Report violations if substantial duplication is found

Violation criteria - Report if:
- Business logic duplicated across files (>30 lines of similar code)
- Complex algorithms or calculations repeated identically
- Data transformation logic that's the same in multiple places
- Functions that could be extracted into shared utilities

Exemptions - Do NOT report:
- Trivial code (one-liners, common patterns like error handling)
- Test code and test utilities
- Similar but contextually different logic (e.g., different validation rules)
- Common patterns (builder methods, getters/setters)
- Standard boilerplate (CLI parsing, config loading)
- Factory methods or templates with intentional configuration duplication
"""
# Glob patterns to match files this rule applies to (optional, defaults to ["**/*"])
scope = ["**/*.rs"]
# Glob patterns to exclude files from this rule (optional, defaults to [])
exclude = []
# Maximum number of files to review per task (optional, overrides global config).
# Increase for simple rules that only check changed files (e.g. scan for hardcoded credentials).
# Decrease for complex rules that scan many additional files (e.g. documentation sync).
max_files_per_task = 3
# Whether violations should block the pipeline (exit 1) (optional, defaults to true)
blocking = true
# Tip for downstream processors (e.g. coding agents) to fix violations (optional)
tip = """
Extract common code into shared functions or modules.
"""
# Rule-specific resources to include in review context.
# Supported formats:
# - `file://glob` - Include matched files' full text, e.g. `file://**/README.md`
# - `sh://command` - Include command output, e.g. `sh://git ls-files`
# - `skill://glob` - Include matched skills, e.g. `skill://~/skills/**/SKILL.md`
resources = ["file://README.md", "sh://git ls-files"]

# Code review rules
[[rules]]
# Human-readable rule name, invisible to LLM
name = "No Magic Numbers"
# Human-readable description, invisible to LLM (optional)
description = "Prevent hardcoded numeric literals"
# Detailed instructions for the LLM on how to check this rule
instruction = """
Only read the focused files. Don't read any other files.

Check for unexplained numeric literals in diff.

Steps:
1. Read focused files and identify numeric literals
2. Check if numbers have explanatory comments or clear context
3. Report violations for unexplained numbers

Violation criteria - Report if:
- Business logic constants without explanation (thresholds, multipliers, limits)
- Arbitrary timeouts or delays without context
- Numeric configuration values hardcoded in logic without comments
- Calculation constants without explanation

Exemptions - Do NOT report:
- 0, 1, -1 in common contexts (indexing, loops, exit codes, boolean-like)
- Numbers in test files
- Numbers in configuration files
- Numbers with nearby comments (within 3 lines above or inline)
- Numbers in default value functions with descriptive context
- HTTP status codes (200, 404, etc.)
- Common time values with clear context (60 for seconds, 24 for hours, 1000 for ms)
- Array/collection sizes in obvious contexts (e.g., Vec::with_capacity(10) in tests)
"""
# Glob patterns to match files this rule applies to (optional, defaults to ["**/*"])
scope = ["**/*.rs"]
# Glob patterns to exclude files from this rule (optional, defaults to [])
exclude = []
# Maximum number of files to review per task (optional, overrides global config).
# Increase for simple rules that only check changed files (e.g. scan for hardcoded credentials).
# Decrease for complex rules that scan many additional files (e.g. documentation sync).
max_files_per_task = 10
# Whether violations should block the pipeline (exit 1) (optional, defaults to true)
blocking = true
# Tip for downstream processors (e.g. coding agents) to fix violations (optional)
tip = """
Define constants with descriptive names or add explanatory comments.
"""
# Rule-specific resources to include in review context.
# Supported formats:
# - `file://glob` - Include matched files' full text, e.g. `file://**/README.md`
# - `sh://command` - Include command output, e.g. `sh://git ls-files`
# - `skill://glob` - Include matched skills, e.g. `skill://~/skills/**/SKILL.md`
resources = []

# Code review rules
[[rules]]
# Human-readable rule name, invisible to LLM
name = "No Hardcoded Credentials"
# Human-readable description, invisible to LLM (optional)
description = "Prevent credential leaks"
# Detailed instructions for the LLM on how to check this rule
instruction = """
Only read the focused files. Don't read any other files.

Check for hardcoded credentials in diff.

Steps:
1. Read focused files and scan for credential-like strings
2. Determine if they are real credentials or placeholders
3. Report violations for any real credentials found

Violation criteria - Report if ANY found:
- API keys, tokens, secrets (e.g., "sk-...", "Bearer ...", actual secret values)
- Passwords or password hashes
- Private keys or certificates
- OAuth client secrets
- Database connection strings with credentials

Exemptions - Do NOT report:
- Placeholder/example values (e.g., "your-api-key", "sk-xxxxxx", "<API_KEY>")
- Environment variable names (e.g., "FIREKEEPER_LLM_API_KEY")
- Public URLs and endpoints
- Email addresses and contact information
- Test/mock credentials in test files clearly marked as fake
- Documentation examples with obvious placeholders
"""
# Glob patterns to match files this rule applies to (optional, defaults to ["**/*"])
scope = ["**/*"]
# Glob patterns to exclude files from this rule (optional, defaults to [])
exclude = []
# Maximum number of files to review per task (optional, overrides global config).
# Increase for simple rules that only check changed files (e.g. scan for hardcoded credentials).
# Decrease for complex rules that scan many additional files (e.g. documentation sync).
max_files_per_task = 10
# Whether violations should block the pipeline (exit 1) (optional, defaults to true)
blocking = true
# Tip for downstream processors (e.g. coding agents) to fix violations (optional)
tip = """
Use environment variables or configuration files for credentials.
Replace real values with placeholders in examples.
"""
# Rule-specific resources to include in review context.
# Supported formats:
# - `file://glob` - Include matched files' full text, e.g. `file://**/README.md`
# - `sh://command` - Include command output, e.g. `sh://git ls-files`
# - `skill://glob` - Include matched skills, e.g. `skill://~/skills/**/SKILL.md`
resources = []

# Code review rules
[[rules]]
# Human-readable rule name, invisible to LLM
name = "Use Tool Args Structs"
# Human-readable description, invisible to LLM (optional)
description = "Use generated tool args structs and TOOL_NAME constants instead of string literals"
# Detailed instructions for the LLM on how to check this rule
instruction = """
Only read the focused files. Don't read any other files.

Check if code uses tool args structs and TOOL_NAME constants correctly.

Steps:
1. Read focused files and look for tool-related code
2. Check if tool names are compared using string literals
3. Check if tool arguments are accessed via JSON parsing instead of deserializing to args structs
4. Report violations for incorrect usage

Violation criteria - Report if:
- Tool names compared with string literals (e.g., tc.function.name == "report") WITHOUT first checking with XxxArgs::TOOL_NAME
- Tool arguments parsed manually with serde_json::from_str::<Value> and .get() instead of deserializing to XxxArgs struct

Correct patterns (do NOT report):
- tc.function.name == crate::tool::think::ThinkArgs::TOOL_NAME (using constant)
- serde_json::from_str::<crate::tool::think::ThinkArgs>(&tc.function.arguments) (deserializing to struct)

Exemptions - Do NOT report:
- Code in tool definition files (src/tool/*.rs)
- Test code
- Generic tool handling code that doesn't know specific tool types
"""
# Glob patterns to match files this rule applies to (optional, defaults to ["**/*"])
scope = ["**/*.rs"]
# Glob patterns to exclude files from this rule (optional, defaults to [])
exclude = []
# Maximum number of files to review per task (optional, overrides global config).
# Increase for simple rules that only check changed files (e.g. scan for hardcoded credentials).
# Decrease for complex rules that scan many additional files (e.g. documentation sync).
max_files_per_task = 10
# Whether violations should block the pipeline (exit 1) (optional, defaults to true)
blocking = true
# Tip for downstream processors (e.g. coding agents) to fix violations (optional)
tip = """
Replace string literals with XxxArgs::TOOL_NAME constants.
Replace manual JSON parsing with serde_json::from_str::<XxxArgs>().
Import tiny_loop::tool::ToolArgs trait if needed.
"""
# Rule-specific resources to include in review context.
# Supported formats:
# - `file://glob` - Include matched files' full text, e.g. `file://**/README.md`
# - `sh://command` - Include command output, e.g. `sh://git ls-files`
# - `skill://glob` - Include matched skills, e.g. `skill://~/skills/**/SKILL.md`
resources = []
